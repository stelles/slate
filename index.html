
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;json&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">json</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="introduction">Introduction</a>
          </li>
          <li>
            <a href="#data-connector" class="toc-h1 toc-link" data-title="data-connector">Data Connector</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#fields" class="toc-h2 toc-link" data-title="fields">Fields</a>
                  </li>
                  <li>
                    <a href="#input-parameters" class="toc-h2 toc-link" data-title="input-parameters">Input Parameters</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>The Data Connector (DC) will be a microservice container that encapsulates the information about the data source and the process which pulls down the data and pushed it to Stratifyd.</p>

<p>The data connector is defined three distinct features:
1. Meta information
  - Defines attributes of the data connector 
  - Answers questions like, What is the source? What user inputs we need?
  - Provides input parameters (generalized input types)
  - Description about what the data will look like
  - Summarized by a JSON standard
2. Aggregate data
  - Given the inputs, pull down, aggregate the data requsted
  - Ex: Given an Amazon URL - pull down all reviews for that URL
  - Return data to the DC server through HTTP communication
3. Communicate information
  - Bad user input? Send error code
  - Finished aggregating/dumping data. Send finished code
  - Streaming data into DC server - (dumping the data requested)</p>

<p>Those three things encapsulate the DC microservice and we will have them all defined.</p>
<h1 id='data-connector'>Data Connector</h1><h2 id='fields'>Fields</h2>
<p>The data connector can be defined by a JSON oject seen to the right. This JSON encapsultes the meta data about the data connector.</p>

<blockquote>
<p>Example data connector looks like this.</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"amazon"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"display_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Amazon"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"params"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"regex"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amazon</span><span class="se">\\</span><span class="s2">.[a-z]{2,3}.*</span><span class="se">\\</span><span class="s2">/([A-Z0-9]{10})"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"multi"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"display_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Amazon Item URL"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"item_url"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"req"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Copy the Amazon item URL and paste it in the field. We can handle different languages."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"enabled"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"date_range"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"image_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://beta.stratifyd.com/images/dataconnectors/icon_amazon.svg"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"roles"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pm"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='required'>Required</h3>
<p>These fields are all required</p>

<p><code>name</code> - URL safe variable name for data connector</p>

<p><code>display_name</code> - Human readable name</p>

<p><code>params</code> - array of <a href="#input-parameters">data connector parameters</a> which control the input for the data connector.</p>

<p><code>enabled</code> - boolean to enabled/disable the data connector</p>

<p><code>date_range</code> - boolean to allow date range selection</p>

<p><code>image_url</code> - an SVG image url which will be used as the image icon</p>
<h3 id='optional'>Optional</h3>
<p>These fields are optional but allow for extra customization for the data connector</p>

<p><code>description</code> - describes what the data connector does and what data it will pull down</p>

<p><code>subdomain</code> - array of domains which will have access to the data connector (default all access)</p>

<!-- `role` - array of predefined roles to categorize the data connector (defaults to category all)

* `cx` - Customer Experience
* `pm` - Product Management
* `research` - Research
* `hr` - Human Resources
* `marketing` - Marketing
 -->
<h2 id='input-parameters'>Input Parameters</h2>
<blockquote>
<p>Examples</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w">    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"regex"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amazon</span><span class="se">\\</span><span class="s2">.[a-z]{2,3}.*</span><span class="se">\\</span><span class="s2">/([A-Z0-9]{10})"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"multi"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"display_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Amazon Item URL"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"item_url"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"req"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Copy the Amazon item URL and paste it in the field. We can handle different languages."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight json tab-json"><code><span class="w">    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"display_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Comments Only"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"comments_only"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"req"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bool"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ignore a user's self posts."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight json tab-json"><code><span class="w">    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"display_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ratings"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Specify which ratings you would like to search or none to search them all."</span><span class="p">,</span><span class="w">
      </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"1"</span><span class="p">:</span><span class="w"> </span><span class="err">True</span><span class="p">,</span><span class="w">
          </span><span class="s2">"2"</span><span class="p">:</span><span class="w"> </span><span class="err">True</span><span class="p">,</span><span class="w">
          </span><span class="s2">"3"</span><span class="p">:</span><span class="w"> </span><span class="err">True</span><span class="p">,</span><span class="w">
          </span><span class="s2">"4"</span><span class="p">:</span><span class="w"> </span><span class="err">True</span><span class="p">,</span><span class="w">
          </span><span class="s2">"5"</span><span class="p">:</span><span class="w"> </span><span class="err">True</span><span class="p">,</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"req"</span><span class="p">:</span><span class="w"> </span><span class="err">False</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"multi_bool"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ratings"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight json tab-json"><code><span class="w">    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="err">'integer'</span><span class="p">,</span><span class="w">
      </span><span class="s2">"req"</span><span class="p">:</span><span class="w"> </span><span class="err">True</span><span class="p">,</span><span class="w">
      </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sets max number of comments to try to crawl and analyze. (Max 50,000)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"display_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Comment Limit"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"max_comments"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w">
      </span><span class="s2">"max"</span><span class="p">:</span><span class="w"> </span><span class="mi">50000</span><span class="p">,</span><span class="w">
      </span><span class="s2">"min"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight json tab-json"><code><span class="w">    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"list"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"req"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"display_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Text Analysis"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"chat_type"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Please select if you want to analyze the agent's chat, the visitor chat or both together."</span><span class="p">,</span><span class="w">
      </span><span class="s2">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Agent"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"agent"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">Visitor</span><span class="s2">",
            "</span><span class="err">value</span><span class="s2">" : "</span><span class="err">visitor</span><span class="s2">"
          }
      ],
      "</span><span class="err">default</span><span class="s2">" : "</span><span class="err">Agent</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">Visitor</span><span class="s2">"
    }
</span></code></pre>
<p>These fields make up generic input parameters for the data connectors. The starred fields for each type are optional unless specfied.</p>
<h3 id='required-2'>Required</h3>
<p><code>display_name</code> - Human readable string with the parameters name</p>

<p><code>name</code> - Programatic variable used for passing the parameter between servers.</p>

<p><code>type</code> - declares what the input <a href="#parameter-types">parameter type</a> </p>

<p><code>req</code> - boolean declaring if the paramter is required</p>

<aside class="warning">The parameter names `start_date` and `end_date` are **NOT** allowed.</aside>
<h3 id='parameter-types'>Parameter    Types</h3>
<p>Each of these types is a different type of input</p>
<h4 id='string'>String</h4>
<p><code>string</code> - user passes in a string and will be returned as a string or array of strings if <code>multi : true</code>.</p>

<ul>
<li><code>regex</code> - string of regular expression for verification on the input</li>
<li><code>multi</code> - boolean modifier which allows for many strings to be passed in as well as changes return from string to array of strings.</li>
</ul>
<h4 id='boolean'>Boolean</h4>
<p><code>bool</code> - a boolean flag for the user to select</p>

<ul>
<li><code>default</code> - boolean value that the input is defaults to</li>
</ul>
<h4 id='multi-boolean'>Multi Boolean</h4>
<p><code>multi_bool</code> - a key, value of input names and boolean flags respectively</p>

<ul>
<li><code>default</code> - <em>required</em> JSON object with key,value pairs where the key is the flag and the value is a boolean</li>
</ul>
<h4 id='integer'>Integer</h4>
<p><code>int</code> - integer for the user to enter</p>

<ul>
<li><code>min</code> - integer that declares the minimum value the user can select</li>
<li><code>max</code> - integer that declares the maximum value the user can select</li>
<li><code>default</code> - default integer</li>
</ul>
<h4 id='list'>List</h4>
<p><code>list</code> - gives the user a list of pre-defined inputs to select</p>

<ul>
<li><code>options</code> - <strong>required</strong> Array of JSON objects which each contain the keys <code>label</code> and <code>value</code> where the label is the human readable string and the value is the programtatic value which will be returned</li>
<li><code>multi</code> - allows the user to select multiple entries from the options list</li>
<li><code>default</code> - string of the default <code>value</code> key inside the options array</li>
</ul>

<hr>

<!-- #Server Calls

```python
from requests import get

req = get("http://localhost/external")
```

> The above will return all data connectors available on this server.

```json
  [
    {
      "name" : "amazon",
      "display_name" : "Amazon",
      "params" : [
        {
          "regex": "amazon\\.[a-z]{2,3}.*\\/([A-Z0-9]{10})", 
          "multi": true, 
          "display_name": "Amazon Item URL", 
          "name": "item_url", 
          "req": true, 
          "type": "string", 
          "description": "Copy the Amazon item URL and paste it in the field. We can handle different languages."
        }
      ],
      "enabled" : true,
      "description" : "Copy the Amazon Product url(s) and Stratifyd will analyze the product reviews."
      "date_range" : true,
      "image_url" : "https://beta.stratifyd.com/images/dataconnectors/icon_amazon.svg",
      "roles" : "pm"
    }
  ]
```


The DC HTTP Server only must handle 2 calls, a GET request for Data connector parameters and POST request that begin the data gathering process which then POST's the data back to the Stratifyd server.

## Load Data Connectors
This will be the **only** GET reqeuest needed for the DC server.  The response will be a JSON array of [data connectors](#data-connector). The endpoint will be `/external`. There will be no URL parameters or special headers.

## Start Data Stream

The DC server process once the query data request is made can be found [here](https://imgur.com/PJ9clb8).  Please review the decision tree which the DC server should follow.

```python
from requests import post

body = {
    "start_date" : null,
    "end_date" : null,
    "item_url" : "https://www.amazon.com/gp/product/B0013JOK8K"
}

### These url params are important for returning data please save them
url_params = {
    'token':  $ACCESS_TOKEN,
    'domain': SUBDOMAIN,
    "id": $STREAM_ID,
}

req = post("http://localhost/external/amazon", data=body)
```

> Above request will return [indexes](#stratifyd-indexes) for the analysis. Example response below

```json
  {
    "text_index" : ["review_text"],
    "date_index" : {
      "unknown" : "review_date",
    }
  }
```

###Stratifyed Indexes
These indexes are used for our analysis engine to process specfic fields. The basic format is `index_type : field_name`

> Example Indexes

```json
  {
    "text_index" : [
      "comment", 
      "title"
    ]
  }
```

```json
  {
    "date_index" :{
      'unknown' : 'review_date'
    }
  }
```

```json
  {
    "geo_index" : {
      "global" : "customer_country",
      "subglobal" : "customer_state",
      "local" : "customer_city"
    }
  }
```

####Text
`text_index` - array of indexes used for textual analysis


####Date
`date_index` - nested indexes with options used for temporal analysis

* `unknown` - field with a string of text that needs parsing into a date
* `timestamp` - either second or milisecond unix timestamp 
* `day` - integer day of the month
* `month` - integer month of the year
* `year` - year 



####Geo
`geo_index` - nested indexes that contain fields with varying geographical information

* `unknown` - geographical string we attempt to parse
* `global`  - country  
* `subglobal` - state/providence 
* `local` - city 
* `sublocal` - street name 
* `postcode` - postal code 
* `latitude` - latitude column 
* `logintude` - longingtude column 
* `latitude_longitude` - column with lat/long in that order 
* `longitude_latitude` - column with long/lat in that order 
* `ip_address` - IP address column  
* `phone_number` - phone # 


## Return Data
To return data, using the url parameters from the [initial data request](#start-date-stream).

Using the request schema, host and port from the port request along with the url parameters we can construct the return POST requests. The url will look like this `https://alphaapi.stratifd.com/streams/5ace79e3b2308449f3608159/documents`.

The following headers will looke like this

Using the following headers

* `Content-Type : 'application/json'`
* `X-Taste-Tmp : ACCESS_TOKEN`
* `X-Taste-App : SUBDOMAIN`

```python
from requests import post
headers = {
    'Content-Type' : 'application/json',
    'X-Taste-Tmp' : ACCESS_TOKEN,
    'X-Taste-App' : SUBDOMAIN
}
url = "https://alphaapi.stratifyd.com/streams/%s/documents" % $STREAM_ID
body = [doc1, doc2, doc3] 
req = post(url, headers=headers, data=body)
```



<aside class="warning">
If status code of post request isn't <code>200</code> please end the stream.
</aside>

 -->

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">json</a>
          </div>
      </div>
    </div>
  </body>
</html>
